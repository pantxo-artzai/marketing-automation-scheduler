<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Action serveur pour créer une activité d'appel -->
    <record id="server_action_create_call_activity" model="ir.actions.server">
        <field name="name">Créer Activité d'Appel</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="binding_model_id" ref="base.model_res_partner"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
# Créer une activité d'appel pour le contact
activity_type = env['mail.activity.type'].search([('name', 'ilike', 'call')], limit=1)
if not activity_type:
    activity_type = env['mail.activity.type'].create({
        'name': 'Call',
        'summary': 'Appel téléphonique',
    })
for partner in records:
    env['mail.activity'].create({
        'res_model_id': env['ir.model']._get_id('res.partner'),
        'res_id': partner.id,
        'activity_type_id': activity_type.id,
        'summary': 'Appel programmé',
    })
        ]]></field>
    </record>
</odoo>

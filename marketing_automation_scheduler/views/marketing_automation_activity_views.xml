<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extension de la vue formulaire des activités Marketing Automation -->
    <record id="marketing_automation_activity_form_inherit" model="ir.ui.view">
        <field name="name">marketing.activity.form.inherit.scheduler</field>
        <field name="model">marketing.activity</field>
        <!-- ID de la vue d'origine à hériter (v18 Enterprise) -->
        <field name="inherit_id" ref="marketing_automation.marketing_activity_view_form"/>
        <!-- Si l'ID ci-dessus n'existe pas dans ta build v18, essaie:
             marketing_automation.view_marketing_activity_form -->
        <field name="arch" type="xml">
            <xpath expr="//field[@name='trigger_type']" position="after">
                <!-- Section Planification Avancée -->
                <group string="Planification Avancée" attrs="{'invisible': [('activity_type', '!=', 'server_action')]}">
                    <field name="is_scheduled"/>
                </group>

                <group string="Paramètres de Planification"
                       attrs="{'invisible': ['|', ('is_scheduled', '=', False), ('activity_type', '!=', 'server_action')]}"
                       col="2">
                    <group string="Quantité et Fréquence">
                        <field name="scheduled_quantity" attrs="{'required': [('is_scheduled', '=', True)]}"/>
                        <field name="schedule_frequency" attrs="{'required': [('is_scheduled', '=', True)]}"/>
                        <field name="custom_interval" attrs="{'invisible': [('schedule_frequency', '!=', 'custom')]}"/>
                        <field name="custom_interval_type" attrs="{'invisible': [('schedule_frequency', '!=', 'custom')]}"/>
                    </group>

                    <group string="Fenêtre de temps">
                        <field name="start_time"/>
                        <field name="end_time"/>
                        <field name="weekdays"/>
                    </group>
                </group>
            </xpath>

            <!-- Onglet de suivi des activités planifiées depuis l’activité source -->
            <xpath expr="//sheet/notebook" position="inside">
                <page string="Planification (Scheduler)">
                    <field name="scheduled_activity_ids" context="{'default_activity_id': active_id}">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="state"/>
                            <field name="scheduled_date"/>
                            <field name="executed_date"/>
                            <button name="action_execute_now"
                                    string="Exécuter"
                                    type="object"
                                    attrs="{'invisible': [('state', '!=', 'scheduled')]}"/>
                            <button name="action_reset_to_scheduled"
                                    string="Replanifier"
                                    type="object"
                                    icon="fa-refresh"
                                    attrs="{'invisible': [('state', '=', 'scheduled')]}"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
